sudo: true
language: c
dist: xenial
before_install:
  - sudo apt-get update -qq
install:
  - sudo apt-get install -qq -y equivs devscripts valgrind colorgcc
  - mk-build-deps debian/control
  - sudo apt-get install -qq -y ./nss-juju-build-deps*.deb
script:
  - ./autogen.sh
  - ./configure CC=$TRAVIS_CC --prefix=/usr --enable-valgrind
  - make check
  - make check-valgrind
  - sudo make install
  - make distcheck
  - make distclean
  - sudo ./debian/libnss-juju.postinst configure
  - getent hosts juju-ip-1-2-3-4 > /tmp/x
  - cat /tmp/x
  - grep 1.2.3.4 /tmp/x
env:
  matrix:
    - TRAVIS_CC=colorgcc EXTRA_CFLAGS='-Wall -Werror'
